<dom-module id="codex-posts">
  <template>
    <style>
      :host {
        display: block;
        padding: 10px;
      }
    </style>

    <firebase-auth user="{{user}}"></firebase-auth>

    <firebase-query
      id="query"
      path="/users/[[user.uid]]/posts"
      data="{{posts}}">
    </firebase-query>

    <h1> [[user.displayName]]'s Posts </h1>

    <h2> Create a New Post - <i>{Test Interface}</i> </h2>

    <paper-input id="draftTitle" label="Title"></paper-input>
    <paper-input id="draftLanguage" label="Language"></paper-input>
    <paper-textarea id="draftContent" label="Content"></paper-textarea>
    <div id="draft-controls">
      <paper-button raised id="create" on-tap="create">Upload Post</paper-button>
    </div>

    <h2> Created Posts </h2>

    <div id="posts">
      <ul id="posts-list">
        <template is="dom-repeat" items="[[posts]]" as="post">
          <li>
            <h3 class="postTitle"> [[post.title]] </h3>
            <h4 class="postLanguage"> Langauge: [[post.language]] <h4>
            <p class="postContent"> [[post.content]] </p>
            <paper-button raised on-tap="remove" post="[[post]]"> Delete Post </paper-button>
          </li>
        </template>
      </ul>
    </div>


  </template>

  <script>
    class codex_posts extends Polymer.Element {
      static get is() {return 'codex-posts';}

      static get properties() {
        return {
          user: {
            type: Object,
            notify: true
          },
          posts: {
            type: Object,
          }
        }
      }

      // Creates post
      create() {
        // Check valid data
        if(this.$.draftTitle.value == null ||
            this.$.draftLanguage.value == null ||
            this.$.draftContent.value == null){

            console.log("Create propper error messages - Missing Fields");
            return -1;
        }

        // Create JSON object and push to database
        this.$.query.ref.push({
          title: this.$.draftTitle.value,
          language: this.$.draftLanguage.value,
          content: this.$.draftContent.value,
        });

        // Reset fields
        this.$.draftTitle.value = null;
        this.$.draftLanguage.value = null;
        this.$.draftContent.value = null;
    }

    // e = event, Will delete a user's post
    remove(e) {
      var key = e.currentTarget.post.$key;
      this.$.query.ref.child(key).remove();
    }

    }


    customElements.define(codex_posts.is,codex_posts);
  </script>

</dom-module>
