<link rel="import" href="bower_components/polymerfire/firebase-auth.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">

<dom-module onload="ready" id="codex-login">
  <template>

    <paper-button id="authBtn" raised on-tap="auth" > Sign In </paper-button>

  </template>

  <script>
    // Polymer({
    //   is: 'codex-login',
    //   properties: {
    //     user: {
    //       type: Object,
    //       observer: "_userchanged2"
    //     },
    //     statusKnown: {
    //       type: Object
    //     },
    //     page: {
    //       type: String
    //     }
    //   },
    //   login: function() {
    //     this.$.page = "profile";
    //     return this.$.auth.signInWithPopup();
    //   },
    //   logout: function() {
    //       return this.$.auth.signOut();
    //   }
    // });

    class codex_login extends Polymer.Element {
      static get is() {return 'codex-login';}

      static get properties() {
        return {
          user: {
            type: Object,
            observer: "_userchanged2"
          },
          statusKnown: {
            type: Object
          },
          page: {
            type: String
          }
        }
      }

      ready() {
        firebase.auth().onAuthStateChanged(function(user) {
          var authbtn = Document.getElementById('authBtn');
          if(user) {
            authbtn.innerHTML = "Sign Out";
            authbtn.setAttribute('on-tap','Logout');
            this.$.user = user;
          } else {
            authbtn.innerHTML = "Sign In";
            authbtn.setAttribute('on-tap','Login');
          }
        });
      }

      login() {
        var provider = new firebase.auth.GoogleAuthProvider();

        firebase.auth().signInWithPopup(provider).then(function(result) {
          var token = result.credential.accessToken;
          var user = result.user;

          var authbtn = Document.getElementById('authBtn');
          authbtn.setAttribute('on-tap','logout');
          authbtn.innerHTML = "Logout";

          this.$.user = user;
        }).catch(function(error) {
          var errorCode = error.code;
          var errorMessage = error.message;
          var email = error.email;
          var credential = error.credential;

          console.log("Error: " + error.message);
        });
      }

      logout() {
        firebase.auth().signOut().then(function() {
          var authbtn = Document.getElementById('authBtn');
          authbtn.setAttribute('on-tap','login');
          authbtn.innerHTML = "Login";
        }).catch(function(error) {
          console.log("Error: " + error.message);
        });
      }
    }


    customElements.define(codex_login.is,codex_login);
  </script>

</dom-module>
